the best BDFS script (and longest one codewise)
